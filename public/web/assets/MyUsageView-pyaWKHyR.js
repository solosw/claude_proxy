import{_ as E,r as n,p as I,c as m,o as r,a as e,j as L,v as k,b as o,w as g,e as c,t as i,g as x,E as w,u as N,f as b,m as P}from"./index-D6aaOR7C.js";const j={class:"p-6"},q={class:"header-section"},D={class:"header-content"},F={key:1,class:"usage-grid"},R={class:"usage-card"},A={class:"usage-value"},G={class:"usage-card"},H={class:"usage-value"},J={class:"usage-card"},K={class:"usage-value"},O={class:"usage-card"},Q={class:"usage-value usage-time"},W={key:2,class:"logs-section"},X={class:"pagination-container"},Y={__name:"MyUsageView",setup(Z){const B=N(),v=n(!1),t=n(null),_=n([]),p=n(!1),d=n(1),f=n(10),y=n(0),C=async()=>{v.value=!0;try{const{data:s}=await x.get("/api/me/usage");t.value=s}catch{t.value=null,w.error("加载我的使用情况失败")}finally{v.value=!1}},h=async()=>{p.value=!0;try{const{data:s}=await x.get("/api/me/usage/logs",{params:{page:d.value,page_size:f.value}});_.value=s.logs||[],y.value=s.total||0}catch{_.value=[],w.error("加载使用日志失败")}finally{p.value=!1}},M=s=>{d.value=s,h()},T=()=>{P.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("token"),localStorage.removeItem("is_admin"),localStorage.removeItem("username"),B.push("/login")}).catch(()=>{})};return I(()=>{C(),h()}),(s,a)=>{const V=c("el-button"),S=c("el-skeleton"),u=c("el-table-column"),U=c("el-table"),z=c("el-pagination");return r(),m("div",j,[e("div",q,[e("div",D,[a[2]||(a[2]=e("div",null,[e("h2",{class:"page-title"},"我的使用情况"),e("p",{class:"page-description"},"查看自己的额度、剩余额度与 Token 使用统计。")],-1)),o(V,{type:"danger",onClick:T},{default:g(()=>a[1]||(a[1]=[b(" 退出登录 ")])),_:1})])]),v.value?(r(),L(S,{key:0,rows:4,animated:""})):t.value?(r(),m("div",F,[e("div",R,[a[3]||(a[3]=e("div",{class:"usage-label"},"总计 Token",-1)),e("div",A,i(t.value.total_tokens),1)]),e("div",G,[a[4]||(a[4]=e("div",{class:"usage-label"},"额度",-1)),e("div",H,i(t.value.unlimited?"无限":t.value.quota),1)]),e("div",J,[a[5]||(a[5]=e("div",{class:"usage-label"},"剩余额度",-1)),e("div",K,i(t.value.unlimited?"无限":t.value.remaining),1)]),e("div",O,[a[6]||(a[6]=e("div",{class:"usage-label"},"过期时间",-1)),e("div",Q,i(t.value.expire_at||"不过期"),1)])])):k("",!0),t.value?(r(),m("div",W,[a[7]||(a[7]=e("h3",{class:"logs-title"},"使用日志",-1)),o(U,{data:_.value,loading:p.value,stripe:"",style:{width:"100%"},class:"usage-logs-table"},{default:g(()=>[o(u,{prop:"model_id",label:"模型名"}),o(u,{prop:"provider",label:"供应商"}),o(u,{label:"消耗总Token",align:"right"},{default:g(({row:l})=>[b(i((l.input_tokens||0)+(l.output_tokens||0)),1)]),_:1}),o(u,{prop:"total_cost",label:"总消耗额度",align:"right"},{default:g(({row:l})=>[b(i(l.total_cost?l.total_cost.toFixed(6):"0"),1)]),_:1}),o(u,{prop:"created_at",label:"时间"})]),_:1},8,["data","loading"]),e("div",X,[o(z,{"current-page":d.value,"onUpdate:currentPage":a[0]||(a[0]=l=>d.value=l),"page-size":f.value,total:y.value,layout:"total, prev, pager, next, jumper",onCurrentChange:M},null,8,["current-page","page-size","total"])])])):k("",!0)])}}},ee=E(Y,[["__scopeId","data-v-5d89b2d9"]]);export{ee as default};
