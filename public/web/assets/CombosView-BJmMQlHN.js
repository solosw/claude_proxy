import{_ as G,r as f,h as H,i as K,j as Q,c as y,o as m,a as p,k as W,b as l,w as a,f as i,l as X,m as N,g as w,E as c,d as r,t as k,F as B,p as D,n as Y,v as Z}from"./index-DCTd3nXU.js";const ee={class:"p-6"},le={class:"header-bar"},te={class:"font-medium"},ae={class:"ml-1 text-gray-500"},oe={key:0,class:"ml-1 text-gray-400"},se={class:"w-full"},de={class:"flex justify-end mb-2"},ne={class:"dialog-footer"},ie={__name:"CombosView",setup(ue){const x=f(!1),h=f([]),U=f([]),_=f(!1),b=f(!1),o=H({id:"",name:"",description:"",enabled:!0,items:[]}),$=f(),C=async()=>{x.value=!0;try{const[d,e]=await Promise.all([w.get("/api/combos"),w.get("/api/models")]);h.value=d.data||[],U.value=e.data||[]}catch{c.error("加载数据失败")}finally{x.value=!1}},E=K(()=>U.value.map(d=>({label:`${d.name||d.id} (${d.provider})`,value:d.id}))),R=()=>{b.value=!1,Object.assign(o,{id:"",name:"",description:"",enabled:!0,items:[]}),_.value=!0},j=d=>{b.value=!0,Object.assign(o,JSON.parse(JSON.stringify(d))),_.value=!0},z=()=>{o.items.push({model_id:"",weight:1,keywords:[]})},O=d=>{o.items.splice(d,1)},S=()=>{var e,u;if(!o.items||o.items.length===0){c.error("请至少添加一个子模型");return}const d={...o,items:o.items.map(n=>({model_id:n.model_id,weight:Number(n.weight)||1,keywords:Array.isArray(n.keywords)?n.keywords:String(n.keywords||"").split(",").map(g=>g.trim()).filter(Boolean)}))};(u=(e=$.value)==null?void 0:e.validate)==null||u.call(e,async n=>{if(n!==!1)try{b.value?(await w.put(`/api/combos/${encodeURIComponent(o.id)}`,d),c.success("更新成功")):(await w.post("/api/combos",d),c.success("创建成功")),_.value=!1,await C()}catch{c.error("保存失败")}})},F=d=>{Z.confirm(`确定要删除组合模型 ${d.id} 吗？`,"提示",{type:"warning"}).then(async()=>{try{await w.delete(`/api/combos/${encodeURIComponent(d.id)}`),c.success("删除成功"),await C()}catch{c.error("删除失败")}}).catch(()=>{})};return Q(C),(d,e)=>{const u=i("el-button"),n=i("el-table-column"),g=i("el-tag"),I=i("el-table"),V=i("el-input"),v=i("el-form-item"),M=i("el-switch"),A=i("el-option"),J=i("el-select"),L=i("el-input-number"),P=i("el-form"),T=i("el-dialog"),q=X("loading");return m(),y("div",ee,[p("div",le,[e[7]||(e[7]=p("h2",{class:"page-title"},"组合模型管理",-1)),l(u,{type:"primary",onClick:R},{default:a(()=>e[6]||(e[6]=[r(" 新建组合模型 ")])),_:1})]),W((m(),N(I,{data:h.value,border:"",style:{width:"100%"}},{default:a(()=>[l(n,{prop:"id",label:"ID",width:"220"}),l(n,{prop:"name",label:"名称",width:"200"}),l(n,{prop:"enabled",label:"启用",width:"100"},{default:a(({row:t})=>[l(g,{type:t.enabled?"success":"info"},{default:a(()=>[r(k(t.enabled?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(n,{label:"子模型",width:"260"},{default:a(({row:t})=>[(m(!0),y(B,null,D(t.items,s=>(m(),y("div",{key:s.model_id,class:"text-xs text-gray-700"},[p("span",te,k(s.model_id),1),p("span",ae,"权重: "+k(s.weight),1),s.keywords&&s.keywords.length?(m(),y("span",oe," 关键词: "+k(s.keywords.join(", ")),1)):Y("",!0)]))),128))]),_:1}),l(n,{prop:"description",label:"描述"}),l(n,{label:"操作",width:"180",fixed:"right"},{default:a(({row:t})=>[l(u,{size:"small",onClick:s=>j(t)},{default:a(()=>e[8]||(e[8]=[r("编辑")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:s=>F(t)},{default:a(()=>e[9]||(e[9]=[r("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,x.value]]),l(T,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:b.value?"编辑组合模型":"新建组合模型",width:"640px"},{footer:a(()=>[p("span",ne,[l(u,{onClick:e[4]||(e[4]=t=>_.value=!1)},{default:a(()=>e[12]||(e[12]=[r("取 消")])),_:1}),l(u,{type:"primary",onClick:S},{default:a(()=>e[13]||(e[13]=[r("确 定")])),_:1})])]),default:a(()=>[l(P,{ref_key:"formRef",ref:$,model:o,"label-width":"100px"},{default:a(()=>[l(v,{label:"ID"},{default:a(()=>[l(V,{modelValue:o.id,"onUpdate:modelValue":e[0]||(e[0]=t=>o.id=t),disabled:b.value},null,8,["modelValue","disabled"])]),_:1}),l(v,{label:"名称"},{default:a(()=>[l(V,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.name=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"描述"},{default:a(()=>[l(V,{modelValue:o.description,"onUpdate:modelValue":e[2]||(e[2]=t=>o.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(v,{label:"启用"},{default:a(()=>[l(M,{modelValue:o.enabled,"onUpdate:modelValue":e[3]||(e[3]=t=>o.enabled=t)},null,8,["modelValue"])]),_:1}),l(v,{label:"子模型"},{default:a(()=>[p("div",se,[p("div",de,[l(u,{size:"small",onClick:z},{default:a(()=>e[10]||(e[10]=[r(" 添加子模型 ")])),_:1})]),l(I,{data:o.items,border:"",size:"small"},{default:a(()=>[l(n,{label:"模型",width:"260"},{default:a(({row:t})=>[l(J,{modelValue:t.model_id,"onUpdate:modelValue":s=>t.model_id=s,placeholder:"选择模型",filterable:"",style:{width:"240px"}},{default:a(()=>[(m(!0),y(B,null,D(E.value,s=>(m(),N(A,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(n,{label:"权重",width:"120"},{default:a(({row:t})=>[l(L,{modelValue:t.weight,"onUpdate:modelValue":s=>t.weight=s,min:0,max:100,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(n,{label:"关键词",width:"220"},{default:a(({row:t})=>[l(V,{modelValue:t.keywords,"onUpdate:modelValue":s=>t.keywords=s,placeholder:"用逗号分隔，例如: 图表, 文本"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(n,{label:"操作",width:"80"},{default:a(t=>[l(u,{size:"small",type:"danger",onClick:s=>O(t.$index)},{default:a(()=>e[11]||(e[11]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},me=G(ie,[["__scopeId","data-v-b48d1797"]]);export{me as default};
