import{_ as E,r as i,p as L,c as b,o as g,a as e,j as N,v as C,b as l,w as d,e as r,t as n,g as w,E as v,u as P,f as p,m as j}from"./index-Cqd-qCq5.js";const q={class:"p-6"},A={class:"header-section"},D={class:"header-content"},F={key:1,class:"usage-grid"},K={class:"usage-card"},R={class:"usage-value"},$={class:"usage-card"},G={class:"usage-value api-key-display"},H={class:"api-key-text"},J={class:"usage-card"},O={class:"usage-value"},Q={class:"usage-card"},W={class:"usage-value"},X={class:"usage-card"},Y={class:"usage-value"},Z={class:"usage-card"},ee={class:"usage-value usage-time"},ae={key:2,class:"logs-section"},se={class:"pagination-container"},te={__name:"MyUsageView",setup(le){const T=P(),_=i(!1),s=i(null),m=i([]),y=i(!1),c=i(1),k=i(10),f=i(0),B=async()=>{_.value=!0;try{const{data:t}=await w.get("/api/me/usage");s.value=t}catch{s.value=null,v.error("加载我的使用情况失败")}finally{_.value=!1}},h=async()=>{y.value=!0;try{const{data:t}=await w.get("/api/me/usage/logs",{params:{page:c.value,page_size:k.value}});m.value=t.logs||[],f.value=t.total||0}catch{m.value=[],v.error("加载使用日志失败")}finally{y.value=!1}},M=t=>{c.value=t,h()},V=()=>{j.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("token"),localStorage.removeItem("is_admin"),localStorage.removeItem("username"),T.push("/login")}).catch(()=>{})},z=t=>{navigator.clipboard.writeText(t).then(()=>{v.success("已复制到剪贴板")}).catch(()=>{v.error("复制失败")})};return L(()=>{B(),h()}),(t,a)=>{const x=r("el-button"),I=r("el-skeleton"),u=r("el-table-column"),S=r("el-table"),U=r("el-pagination");return g(),b("div",q,[e("div",A,[e("div",D,[a[3]||(a[3]=e("div",null,[e("h2",{class:"page-title"},"我的使用情况"),e("p",{class:"page-description"},"查看自己的额度、剩余额度与 Token 使用统计。")],-1)),l(x,{type:"danger",onClick:V},{default:d(()=>a[2]||(a[2]=[p(" 退出登录 ")])),_:1})])]),_.value?(g(),N(I,{key:0,rows:4,animated:""})):s.value?(g(),b("div",F,[e("div",K,[a[4]||(a[4]=e("div",{class:"usage-label"},"用户名",-1)),e("div",R,n(s.value.username),1)]),e("div",$,[a[6]||(a[6]=e("div",{class:"usage-label"},"API Key",-1)),e("div",G,[e("span",H,n(s.value.api_key),1),l(x,{link:"",type:"primary",size:"small",onClick:a[0]||(a[0]=o=>z(s.value.api_key))},{default:d(()=>a[5]||(a[5]=[p(" 复制 ")])),_:1})])]),e("div",J,[a[7]||(a[7]=e("div",{class:"usage-label"},"总计 Token",-1)),e("div",O,n(s.value.total_tokens),1)]),e("div",Q,[a[8]||(a[8]=e("div",{class:"usage-label"},"额度",-1)),e("div",W,n(s.value.unlimited?"无限":s.value.quota),1)]),e("div",X,[a[9]||(a[9]=e("div",{class:"usage-label"},"剩余额度",-1)),e("div",Y,n(s.value.unlimited?"无限":s.value.remaining),1)]),e("div",Z,[a[10]||(a[10]=e("div",{class:"usage-label"},"过期时间",-1)),e("div",ee,n(s.value.expire_at||"不过期"),1)])])):C("",!0),s.value?(g(),b("div",ae,[a[11]||(a[11]=e("h3",{class:"logs-title"},"使用日志",-1)),l(S,{data:m.value,loading:y.value,stripe:"",style:{width:"100%"},class:"usage-logs-table"},{default:d(()=>[l(u,{prop:"model_id",label:"模型名"}),l(u,{prop:"provider",label:"供应商"}),l(u,{label:"消耗总Token",align:"right"},{default:d(({row:o})=>[p(n((o.input_tokens||0)+(o.output_tokens||0)),1)]),_:1}),l(u,{prop:"total_cost",label:"总消耗额度",align:"right"},{default:d(({row:o})=>[p(n(o.total_cost?o.total_cost.toFixed(6):"0"),1)]),_:1}),l(u,{prop:"created_at",label:"时间"})]),_:1},8,["data","loading"]),e("div",se,[l(U,{"current-page":c.value,"onUpdate:currentPage":a[1]||(a[1]=o=>c.value=o),"page-size":k.value,total:f.value,layout:"total, prev, pager, next, jumper",onCurrentChange:M},null,8,["current-page","page-size","total"])])])):C("",!0)])}}},ne=E(te,[["__scopeId","data-v-ab526a3b"]]);export{ne as default};
