import{_ as Y,r as p,i as I,p as j,c,o as v,a as l,j as U,v as w,b as a,w as o,e as g,t as i,F,l as H,g as L,E as b,u as q,f as n,m as G}from"./index-ZgPeMoVT.js";const J={class:"p-6"},Q={class:"header-section"},W={class:"header-content"},X={key:1,class:"usage-grid"},Z={class:"usage-card"},h={class:"usage-value"},ee={class:"usage-card"},le={class:"usage-value api-key-display"},se={class:"api-key-text"},te={class:"usage-card"},ae={class:"usage-value"},oe={class:"usage-card"},ie={class:"usage-value"},ne={class:"usage-card"},de={class:"usage-value"},ue={class:"usage-card"},re={class:"usage-value usage-time"},ve={key:0,class:"usage-card full-width"},pe={class:"usage-value combo-tags"},ge={key:1,class:"usage-card full-width"},_e={key:2,class:"logs-section"},ce={class:"pagination-container"},me={key:3,class:"guide-section"},ke={class:"guide-block"},ye={class:"guide-code-line"},be={class:"guide-code-line"},fe={class:"guide-code-line"},Ce={class:"guide-block"},xe={class:"guide-code-line"},Ae={class:"guide-code-line"},Ie={class:"guide-block"},we={class:"guide-code-line"},Ee={class:"guide-code-line"},Be={class:"guide-block"},Pe={class:"guide-code-line"},ze={class:"guide-code-line"},Te={class:"guide-tip"},Ue={__name:"MyUsageView",setup(Le){const S=q(),f=p(!1),t=p(null),C=p([]),x=p(!1),k=p(1),E=p(10),B=p(0),P=p("claude-code"),$=async()=>{f.value=!0;try{const{data:d}=await L.get("/api/me/usage");t.value=d}catch{t.value=null,b.error("加载我的使用情况失败")}finally{f.value=!1}},z=I(()=>{var d;return(d=t.value)!=null&&d.allowed_combos?t.value.allowed_combos.split(",").map(e=>e.trim()).filter(Boolean):[]}),A=I(()=>`${window.location.origin}/back`),m=I(()=>`${window.location.origin}/back/v1`),T=async()=>{x.value=!0;try{const{data:d}=await L.get("/api/me/usage/logs",{params:{page:k.value,page_size:E.value}});C.value=d.logs||[],B.value=d.total||0}catch{C.value=[],b.error("加载使用日志失败")}finally{x.value=!1}},N=d=>{k.value=d,T()},O=()=>{G.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("token"),localStorage.removeItem("is_admin"),localStorage.removeItem("username"),S.push("/login")}).catch(()=>{})},r=d=>{navigator.clipboard.writeText(d).then(()=>{b.success("已复制到剪贴板")}).catch(()=>{b.error("复制失败")})};return j(()=>{$(),T()}),(d,e)=>{const u=g("el-button"),R=g("el-skeleton"),V=g("el-tag"),_=g("el-table-column"),K=g("el-table"),M=g("el-pagination"),y=g("el-tab-pane"),D=g("el-tabs");return v(),c("div",J,[l("div",Q,[l("div",W,[e[13]||(e[13]=l("div",null,[l("h2",{class:"page-title"},"我的使用情况"),l("p",{class:"page-description"},"查看自己的额度、剩余额度与 Token 使用统计。")],-1)),a(u,{type:"danger",onClick:O},{default:o(()=>e[12]||(e[12]=[n(" 退出登录 ")])),_:1})])]),f.value?(v(),U(R,{key:0,rows:4,animated:""})):t.value?(v(),c("div",X,[l("div",Z,[e[14]||(e[14]=l("div",{class:"usage-label"},"用户名",-1)),l("div",h,i(t.value.username),1)]),l("div",ee,[e[16]||(e[16]=l("div",{class:"usage-label"},"API Key",-1)),l("div",le,[l("span",se,i(t.value.api_key),1),a(u,{link:"",type:"primary",size:"small",onClick:e[0]||(e[0]=s=>r(t.value.api_key))},{default:o(()=>e[15]||(e[15]=[n(" 复制 ")])),_:1})])]),l("div",te,[e[17]||(e[17]=l("div",{class:"usage-label"},"总计 Token",-1)),l("div",ae,i(t.value.total_tokens),1)]),l("div",oe,[e[18]||(e[18]=l("div",{class:"usage-label"},"额度",-1)),l("div",ie,i(t.value.unlimited?"无限":t.value.quota),1)]),l("div",ne,[e[19]||(e[19]=l("div",{class:"usage-label"},"剩余额度",-1)),l("div",de,i(t.value.unlimited?"无限":t.value.remaining),1)]),l("div",ue,[e[20]||(e[20]=l("div",{class:"usage-label"},"过期时间",-1)),l("div",re,i(t.value.expire_at?new Date(t.value.expire_at).toLocaleString():"-"),1)]),z.value.length?(v(),c("div",ve,[e[21]||(e[21]=l("div",{class:"usage-label"},"可用模型",-1)),l("div",pe,[(v(!0),c(F,null,H(z.value,s=>(v(),U(V,{key:s,type:"success",class:"mr-2 mb-1"},{default:o(()=>[n(i(s),1)]),_:2},1024))),128))])])):(v(),c("div",ge,e[22]||(e[22]=[l("div",{class:"usage-label"},"可用模型",-1),l("div",{class:"usage-value usage-time"},"不限制（可使用任意模型）",-1)])))])):w("",!0),t.value?(v(),c("div",_e,[e[23]||(e[23]=l("h3",{class:"logs-title"},"使用日志",-1)),a(K,{data:C.value,loading:x.value,stripe:"",style:{width:"100%"},class:"usage-logs-table"},{default:o(()=>[a(_,{prop:"model_id",label:"模型名"}),a(_,{prop:"provider",label:"供应商"}),a(_,{label:"输入 Token",align:"right"},{default:o(({row:s})=>[n(i(s.input_tokens||0),1)]),_:1}),a(_,{label:"输出 Token",align:"right"},{default:o(({row:s})=>[n(i(s.output_tokens||0),1)]),_:1}),a(_,{label:"总 Token",align:"right"},{default:o(({row:s})=>[n(i((s.input_tokens||0)+(s.output_tokens||0)),1)]),_:1}),a(_,{prop:"total_cost",label:"总费用",align:"right"},{default:o(({row:s})=>[n(i(s.total_cost?s.total_cost.toFixed(6):"0.000000"),1)]),_:1}),a(_,{prop:"created_at",label:"时间"},{default:o(({row:s})=>[n(i(s.created_at?new Date(s.created_at).toLocaleString():"-"),1)]),_:1})]),_:1},8,["data","loading"]),l("div",ce,[a(M,{"current-page":k.value,"onUpdate:currentPage":e[1]||(e[1]=s=>k.value=s),"page-size":E.value,total:B.value,layout:"total, prev, pager, next, jumper",onCurrentChange:N},null,8,["current-page","page-size","total"])])])):w("",!0),t.value?(v(),c("div",me,[e[42]||(e[42]=l("h3",{class:"guide-title"},"使用说明",-1)),a(D,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value=s),class:"guide-tabs",stretch:""},{default:o(()=>[a(y,{label:"Claude Code",name:"claude-code"},{default:o(()=>[l("div",ke,[e[28]||(e[28]=l("p",{class:"guide-text"},"适用于日常开发与代码协作。将当前账号 API Key 配置到 Anthropic 环境变量后即可使用。",-1)),e[29]||(e[29]=l("div",{class:"guide-step"},"1. 配置环境变量",-1)),l("div",ye,[l("code",null,"ANTHROPIC_BASE_URL="+i(A.value),1),a(u,{link:"",type:"primary",size:"small",onClick:e[2]||(e[2]=s=>r(A.value))},{default:o(()=>e[24]||(e[24]=[n("复制")])),_:1})]),l("div",be,[l("code",null,"ANTHROPIC_API_KEY="+i(t.value.api_key),1),a(u,{link:"",type:"primary",size:"small",onClick:e[3]||(e[3]=s=>r(t.value.api_key))},{default:o(()=>e[25]||(e[25]=[n("复制")])),_:1})]),e[30]||(e[30]=l("div",{class:"guide-step"},"2. 启动 Claude Code",-1)),l("div",fe,[e[27]||(e[27]=l("code",null,"claude",-1)),a(u,{link:"",type:"primary",size:"small",onClick:e[4]||(e[4]=s=>r("claude"))},{default:o(()=>e[26]||(e[26]=[n("复制")])),_:1})])])]),_:1}),a(y,{label:"Codex",name:"codex"},{default:o(()=>[l("div",Ce,[e[33]||(e[33]=l("p",{class:"guide-text"},"Codex 客户端通常可通过 OpenAI Response接入本项目网关。",-1)),e[34]||(e[34]=l("div",{class:"guide-step"},"1. 配置 OpenAI 兼容地址与 Key",-1)),l("div",xe,[l("code",null,"OPENAI_BASE_URL="+i(m.value),1),a(u,{link:"",type:"primary",size:"small",onClick:e[5]||(e[5]=s=>r(m.value))},{default:o(()=>e[31]||(e[31]=[n("复制")])),_:1})]),l("div",Ae,[l("code",null,"OPENAI_API_KEY="+i(t.value.api_key),1),a(u,{link:"",type:"primary",size:"small",onClick:e[6]||(e[6]=s=>r(t.value.api_key))},{default:o(()=>e[32]||(e[32]=[n("复制")])),_:1})]),e[35]||(e[35]=l("p",{class:"guide-tip"},"配置后，在 Codex 中选择可用模型即可开始使用。",-1))])]),_:1}),a(y,{label:"OpenCode",name:"opencode"},{default:o(()=>[l("div",Ie,[e[38]||(e[38]=l("p",{class:"guide-text"},"OpenCode 同样可按 OpenAI chat方式配置",-1)),l("div",we,[l("code",null,"OPENAI_BASE_URL="+i(m.value),1),a(u,{link:"",type:"primary",size:"small",onClick:e[7]||(e[7]=s=>r(m.value))},{default:o(()=>e[36]||(e[36]=[n("复制")])),_:1})]),l("div",Ee,[l("code",null,"OPENAI_API_KEY="+i(t.value.api_key),1),a(u,{link:"",type:"primary",size:"small",onClick:e[8]||(e[8]=s=>r(t.value.api_key))},{default:o(()=>e[37]||(e[37]=[n("复制")])),_:1})])])]),_:1}),a(y,{label:"其他",name:"project-config"},{default:o(()=>[l("div",Be,[e[41]||(e[41]=l("p",{class:"guide-text"},"其他支持任何自定义模型openai chat接口。",-1)),l("div",Pe,[l("code",null,"BASE_URL="+i(m.value),1),a(u,{link:"",type:"primary",size:"small",onClick:e[9]||(e[9]=s=>r(m.value))},{default:o(()=>e[39]||(e[39]=[n("复制")])),_:1})]),l("div",ze,[l("code",null,"API_KEY="+i(t.value.api_key),1),a(u,{link:"",type:"primary",size:"small",onClick:e[10]||(e[10]=s=>r(t.value.api_key))},{default:o(()=>e[40]||(e[40]=[n("复制")])),_:1})]),l("p",Te,"若使用 Anthropic SDK，请将 Base URL 改为 "+i(A.value)+"。",1)])]),_:1})]),_:1},8,["modelValue"])])):w("",!0)])}}},$e=Y(Ue,[["__scopeId","data-v-be8bfd8b"]]);export{$e as default};
