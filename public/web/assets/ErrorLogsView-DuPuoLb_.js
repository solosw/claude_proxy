import{_ as U,r,p as j,c as x,o as p,a as c,q as $,b as l,w as o,e as s,s as q,j as C,g as z,E as A,f as g,F as G,l as H,t as v}from"./index-ZgPeMoVT.js";const J={class:"p-6"},K={class:"flex items-center justify-between mb-4"},O={class:"filter-panel mb-4"},Q={class:"error-msg"},R={class:"pagination-bar"},W={__name:"ErrorLogsView",setup(X){const m=r(!1),f=r([]),b=r(0),h=r([]),u=r(""),n=r(1),_=r(20),D=async()=>{try{const{data:t}=await z.get("/api/models");h.value=t||[]}catch{}},i=async()=>{m.value=!0;try{const t={page:n.value,page_size:_.value};u.value&&(t.model_id=u.value);const{data:a}=await z.get("/api/error-logs",{params:t});f.value=a.logs||[],b.value=a.total||0}catch{A.error("加载错误日志失败")}finally{m.value=!1}},V=()=>{n.value=1,i()},k=t=>{n.value=t,i()},S=t=>{_.value=t,n.value=1,i()},E=()=>{u.value="",n.value=1,i()},I=t=>t===0?"info":t>=500?"danger":t>=400?"warning":"success";return j(()=>{D(),i()}),(t,a)=>{const w=s("el-button"),L=s("el-option"),B=s("el-select"),y=s("el-form-item"),F=s("el-form"),d=s("el-table-column"),M=s("el-tag"),N=s("el-table"),P=s("el-pagination"),T=q("loading");return p(),x("div",J,[c("div",K,[a[4]||(a[4]=c("h2",{class:"text-xl font-semibold"},"错误日志",-1)),l(w,{onClick:i},{default:o(()=>a[3]||(a[3]=[g("刷新")])),_:1})]),c("div",O,[l(F,{layout:"inline",class:"filter-form"},{default:o(()=>[l(y,{label:"模型 ID"},{default:o(()=>[l(B,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),placeholder:"全部模型",clearable:"",filterable:"",style:{width:"260px"},onChange:V},{default:o(()=>[(p(!0),x(G,null,H(h.value,e=>(p(),C(L,{key:e.id,label:`${e.name||e.id} (${e.id})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,null,{default:o(()=>[l(w,{onClick:E},{default:o(()=>a[5]||(a[5]=[g("重置")])),_:1})]),_:1})]),_:1})]),$((p(),C(N,{data:f.value,border:"",style:{width:"100%"}},{default:o(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"model_id",label:"模型 ID",width:"220"}),l(d,{prop:"username",label:"用户",width:"160"}),l(d,{prop:"status_code",label:"状态码",width:"100"},{default:o(({row:e})=>[l(M,{type:I(e.status_code),size:"small"},{default:o(()=>[g(v(e.status_code||"-"),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"error_msg",label:"错误信息","min-width":"300"},{default:o(({row:e})=>[c("span",Q,v(e.error_msg),1)]),_:1}),l(d,{prop:"created_at",label:"时间",width:"180"},{default:o(({row:e})=>[g(v(e.created_at?new Date(e.created_at).toLocaleString():"-"),1)]),_:1})]),_:1},8,["data"])),[[T,m.value]]),c("div",R,[l(P,{"current-page":n.value,"onUpdate:currentPage":a[1]||(a[1]=e=>n.value=e),"page-size":_.value,"onUpdate:pageSize":a[2]||(a[2]=e=>_.value=e),total:b.value,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onCurrentChange:k,onSizeChange:S},null,8,["current-page","page-size","total"])])])}}},Z=U(W,[["__scopeId","data-v-ecced9d7"]]);export{Z as default};
