import{_ as G,r as b,n as H,i as K,p as Q,c as w,o as m,a as p,q as W,b as l,w as o,e as i,s as X,j as N,g as V,E as c,f as u,t as k,F as B,l as D,v as Y,m as Z}from"./index-ZgPeMoVT.js";const ee={class:"p-6"},le={class:"header-bar"},te={class:"font-medium"},oe={class:"ml-1 text-gray-500"},ae={key:0,class:"ml-1 text-gray-400"},se={class:"w-full"},de={class:"flex justify-end mb-2"},ne={class:"dialog-footer"},ie={__name:"CombosView",setup(re){const x=b(!1),h=b([]),U=b([]),_=b(!1),v=b(!1),a=H({id:"",name:"",provider:"",description:"",enabled:!0,items:[]}),$=b(),C=async()=>{x.value=!0;try{const[n,e]=await Promise.all([V.get("/api/combos"),V.get("/api/models")]);h.value=n.data||[],U.value=e.data||[]}catch{c.error("加载数据失败")}finally{x.value=!1}},E=K(()=>U.value.map(n=>({label:`${n.name||n.id} (${n.provider})`,value:n.id}))),R=()=>{v.value=!1,Object.assign(a,{id:"",name:"",provider:"",description:"",enabled:!0,items:[]}),_.value=!0},j=n=>{v.value=!0,Object.assign(a,JSON.parse(JSON.stringify(n))),_.value=!0},z=()=>{a.items.push({model_id:"",weight:1,keywords:[]})},O=n=>{a.items.splice(n,1)},S=()=>{var e,r;if(!a.items||a.items.length===0){c.error("请至少添加一个子模型");return}const n={...a,items:a.items.map(s=>({model_id:s.model_id,weight:Number(s.weight)||1,keywords:Array.isArray(s.keywords)?s.keywords:String(s.keywords||"").split(",").map(g=>g.trim()).filter(Boolean)}))};(r=(e=$.value)==null?void 0:e.validate)==null||r.call(e,async s=>{if(s!==!1)try{v.value?(await V.put(`/api/combos/${encodeURIComponent(a.id)}`,n),c.success("更新成功")):(await V.post("/api/combos",n),c.success("创建成功")),_.value=!1,await C()}catch{c.error("保存失败")}})},F=n=>{Z.confirm(`确定要删除组合模型 ${n.id} 吗？`,"提示",{type:"warning"}).then(async()=>{try{await V.delete(`/api/combos/${encodeURIComponent(n.id)}`),c.success("删除成功"),await C()}catch{c.error("删除失败")}}).catch(()=>{})};return Q(C),(n,e)=>{const r=i("el-button"),s=i("el-table-column"),g=i("el-tag"),I=i("el-table"),y=i("el-input"),f=i("el-form-item"),M=i("el-switch"),A=i("el-option"),J=i("el-select"),q=i("el-input-number"),L=i("el-form"),P=i("el-dialog"),T=X("loading");return m(),w("div",ee,[p("div",le,[e[8]||(e[8]=p("h2",{class:"page-title"},"组合模型管理",-1)),l(r,{type:"primary",onClick:R},{default:o(()=>e[7]||(e[7]=[u(" 新建组合模型 ")])),_:1})]),W((m(),N(I,{data:h.value,border:"",style:{width:"100%"}},{default:o(()=>[l(s,{prop:"id",label:"ID",width:"220"}),l(s,{prop:"name",label:"名称",width:"180"}),l(s,{prop:"provider",label:"提供商",width:"120"}),l(s,{prop:"enabled",label:"启用",width:"100"},{default:o(({row:t})=>[l(g,{type:t.enabled?"success":"info"},{default:o(()=>[u(k(t.enabled?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(s,{label:"子模型",width:"260"},{default:o(({row:t})=>[(m(!0),w(B,null,D(t.items,d=>(m(),w("div",{key:d.model_id,class:"text-xs text-gray-700"},[p("span",te,k(d.model_id),1),p("span",oe,"权重: "+k(d.weight),1),d.keywords&&d.keywords.length?(m(),w("span",ae," 关键词: "+k(d.keywords.join(", ")),1)):Y("",!0)]))),128))]),_:1}),l(s,{prop:"description",label:"描述"}),l(s,{label:"操作",width:"180",fixed:"right"},{default:o(({row:t})=>[l(r,{size:"small",onClick:d=>j(t)},{default:o(()=>e[9]||(e[9]=[u("编辑")])),_:2},1032,["onClick"]),l(r,{size:"small",type:"danger",onClick:d=>F(t)},{default:o(()=>e[10]||(e[10]=[u("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,x.value]]),l(P,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),title:v.value?"编辑组合模型":"新建组合模型",width:"640px"},{footer:o(()=>[p("span",ne,[l(r,{onClick:e[5]||(e[5]=t=>_.value=!1)},{default:o(()=>e[13]||(e[13]=[u("取 消")])),_:1}),l(r,{type:"primary",onClick:S},{default:o(()=>e[14]||(e[14]=[u("确 定")])),_:1})])]),default:o(()=>[l(L,{ref_key:"formRef",ref:$,model:a,"label-width":"100px"},{default:o(()=>[l(f,{label:"ID"},{default:o(()=>[l(y,{modelValue:a.id,"onUpdate:modelValue":e[0]||(e[0]=t=>a.id=t),disabled:v.value},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"名称"},{default:o(()=>[l(y,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=t=>a.name=t)},null,8,["modelValue"])]),_:1}),l(f,{label:"提供商"},{default:o(()=>[l(y,{modelValue:a.provider,"onUpdate:modelValue":e[2]||(e[2]=t=>a.provider=t),placeholder:"例如: custom, openai"},null,8,["modelValue"])]),_:1}),l(f,{label:"描述"},{default:o(()=>[l(y,{modelValue:a.description,"onUpdate:modelValue":e[3]||(e[3]=t=>a.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),l(f,{label:"启用"},{default:o(()=>[l(M,{modelValue:a.enabled,"onUpdate:modelValue":e[4]||(e[4]=t=>a.enabled=t)},null,8,["modelValue"])]),_:1}),l(f,{label:"子模型"},{default:o(()=>[p("div",se,[p("div",de,[l(r,{size:"small",onClick:z},{default:o(()=>e[11]||(e[11]=[u(" 添加子模型 ")])),_:1})]),l(I,{data:a.items,border:"",size:"small"},{default:o(()=>[l(s,{label:"模型",width:"260"},{default:o(({row:t})=>[l(J,{modelValue:t.model_id,"onUpdate:modelValue":d=>t.model_id=d,placeholder:"选择模型",filterable:"",style:{width:"240px"}},{default:o(()=>[(m(!0),w(B,null,D(E.value,d=>(m(),N(A,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(s,{label:"权重",width:"120"},{default:o(({row:t})=>[l(q,{modelValue:t.weight,"onUpdate:modelValue":d=>t.weight=d,min:0,max:100,step:.1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(s,{label:"关键词",width:"220"},{default:o(({row:t})=>[l(y,{modelValue:t.keywords,"onUpdate:modelValue":d=>t.keywords=d,placeholder:"用逗号分隔，例如: 图表, 文本"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(s,{label:"操作",width:"80"},{default:o(t=>[l(r,{size:"small",type:"danger",onClick:d=>O(t.$index)},{default:o(()=>e[12]||(e[12]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},me=G(ie,[["__scopeId","data-v-f6b8e22c"]]);export{me as default};
