import{_ as P,r as c,i as D,p as F,c as g,o as u,a,j as C,v as T,b as n,w as i,e as v,t as o,F as j,l as q,g as B,E as p,u as A,f as d,m as K}from"./index-BbdJjvGl.js";const R={class:"p-6"},$={class:"header-section"},G={class:"header-content"},H={key:1,class:"usage-grid"},J={class:"usage-card"},O={class:"usage-value"},Q={class:"usage-card"},W={class:"usage-value api-key-display"},X={class:"api-key-text"},Y={class:"usage-card"},Z={class:"usage-value"},ee={class:"usage-card"},ae={class:"usage-value"},se={class:"usage-card"},te={class:"usage-value"},le={class:"usage-card"},oe={class:"usage-value usage-time"},ne={key:0,class:"usage-card full-width"},ie={class:"usage-value combo-tags"},ue={key:1,class:"usage-card full-width"},de={key:2,class:"logs-section"},re={class:"pagination-container"},ce={__name:"MyUsageView",setup(ge){const L=A(),m=c(!1),t=c(null),b=c([]),y=c(!1),_=c(1),k=c(10),f=c(0),S=async()=>{m.value=!0;try{const{data:l}=await B.get("/api/me/usage");t.value=l}catch{t.value=null,p.error("加载我的使用情况失败")}finally{m.value=!1}},h=D(()=>{var l;return(l=t.value)!=null&&l.allowed_combos?t.value.allowed_combos.split(",").map(e=>e.trim()).filter(Boolean):[]}),x=async()=>{y.value=!0;try{const{data:l}=await B.get("/api/me/usage/logs",{params:{page:_.value,page_size:k.value}});b.value=l.logs||[],f.value=l.total||0}catch{b.value=[],p.error("加载使用日志失败")}finally{y.value=!1}},M=l=>{_.value=l,x()},V=()=>{K.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{localStorage.removeItem("token"),localStorage.removeItem("is_admin"),localStorage.removeItem("username"),L.push("/login")}).catch(()=>{})},z=l=>{navigator.clipboard.writeText(l).then(()=>{p.success("已复制到剪贴板")}).catch(()=>{p.error("复制失败")})};return F(()=>{S(),x()}),(l,e)=>{const w=v("el-button"),I=v("el-skeleton"),N=v("el-tag"),r=v("el-table-column"),U=v("el-table"),E=v("el-pagination");return u(),g("div",R,[a("div",$,[a("div",G,[e[3]||(e[3]=a("div",null,[a("h2",{class:"page-title"},"我的使用情况"),a("p",{class:"page-description"},"查看自己的额度、剩余额度与 Token 使用统计。")],-1)),n(w,{type:"danger",onClick:V},{default:i(()=>e[2]||(e[2]=[d(" 退出登录 ")])),_:1})])]),m.value?(u(),C(I,{key:0,rows:4,animated:""})):t.value?(u(),g("div",H,[a("div",J,[e[4]||(e[4]=a("div",{class:"usage-label"},"用户名",-1)),a("div",O,o(t.value.username),1)]),a("div",Q,[e[6]||(e[6]=a("div",{class:"usage-label"},"API Key",-1)),a("div",W,[a("span",X,o(t.value.api_key),1),n(w,{link:"",type:"primary",size:"small",onClick:e[0]||(e[0]=s=>z(t.value.api_key))},{default:i(()=>e[5]||(e[5]=[d(" 复制 ")])),_:1})])]),a("div",Y,[e[7]||(e[7]=a("div",{class:"usage-label"},"总计 Token",-1)),a("div",Z,o(t.value.total_tokens),1)]),a("div",ee,[e[8]||(e[8]=a("div",{class:"usage-label"},"额度",-1)),a("div",ae,o(t.value.unlimited?"无限":t.value.quota),1)]),a("div",se,[e[9]||(e[9]=a("div",{class:"usage-label"},"剩余额度",-1)),a("div",te,o(t.value.unlimited?"无限":t.value.remaining),1)]),a("div",le,[e[10]||(e[10]=a("div",{class:"usage-label"},"过期时间",-1)),a("div",oe,o(t.value.expire_at?new Date(t.value.expire_at).toLocaleString():"-"),1)]),h.value.length?(u(),g("div",ne,[e[11]||(e[11]=a("div",{class:"usage-label"},"可用模型",-1)),a("div",ie,[(u(!0),g(j,null,q(h.value,s=>(u(),C(N,{key:s,type:"success",class:"mr-2 mb-1"},{default:i(()=>[d(o(s),1)]),_:2},1024))),128))])])):(u(),g("div",ue,e[12]||(e[12]=[a("div",{class:"usage-label"},"可用模型",-1),a("div",{class:"usage-value usage-time"},"不限制（可使用任意模型）",-1)])))])):T("",!0),t.value?(u(),g("div",de,[e[13]||(e[13]=a("h3",{class:"logs-title"},"使用日志",-1)),n(U,{data:b.value,loading:y.value,stripe:"",style:{width:"100%"},class:"usage-logs-table"},{default:i(()=>[n(r,{prop:"model_id",label:"模型名"}),n(r,{prop:"provider",label:"供应商"}),n(r,{label:"输入 Token",align:"right"},{default:i(({row:s})=>[d(o(s.input_tokens||0),1)]),_:1}),n(r,{label:"输出 Token",align:"right"},{default:i(({row:s})=>[d(o(s.output_tokens||0),1)]),_:1}),n(r,{label:"总 Token",align:"right"},{default:i(({row:s})=>[d(o((s.input_tokens||0)+(s.output_tokens||0)),1)]),_:1}),n(r,{prop:"total_cost",label:"总费用",align:"right"},{default:i(({row:s})=>[d(o(s.total_cost?s.total_cost.toFixed(6):"0.000000"),1)]),_:1}),n(r,{prop:"created_at",label:"时间"},{default:i(({row:s})=>[d(o(s.created_at?new Date(s.created_at).toLocaleString():"-"),1)]),_:1})]),_:1},8,["data","loading"]),a("div",re,[n(E,{"current-page":_.value,"onUpdate:currentPage":e[1]||(e[1]=s=>_.value=s),"page-size":k.value,total:f.value,layout:"total, prev, pager, next, jumper",onCurrentChange:M},null,8,["current-page","page-size","total"])])])):T("",!0)])}}},_e=P(ce,[["__scopeId","data-v-b70fa917"]]);export{_e as default};
