import{_ as ee,r as c,n as z,p as le,c as T,o as v,a as s,q as te,b as l,w as a,e as i,s as ae,j as V,g as w,E as f,f as d,t as p,v as $,m as se}from"./index-Cqd-qCq5.js";const ne={class:"p-6"},oe={class:"flex items-center justify-between mb-4"},ie={class:"filter-panel mb-4"},ue={class:"api-key-cell"},re={class:"api-key-text"},de={key:0,class:"form-hint-inline"},me={class:"dialog-footer"},pe={key:1,class:"usage-panel"},_e={class:"usage-row"},fe={class:"usage-row"},ce={class:"usage-row"},ve={class:"usage-row"},ye={class:"usage-row"},ge={class:"usage-row"},ke={class:"usage-row"},be={__name:"UsersView",setup(Ve){const x=c(!1),D=c([]),C=c(!1),U=c(!1),r=c(null),k=c(!1),y=c(!1),B=c(),o=z({username:"",api_key:"",quota:-1,expire_at:"",is_admin:!1}),A={},m=z({username:"",is_admin:""}),b=async()=>{x.value=!0;try{const n={};m.username&&(n.username=m.username),m.is_admin!==""&&(n.is_admin=m.is_admin);const{data:e}=await w.get("/api/users",{params:n});D.value=e||[]}catch{f.error("加载用户列表失败")}finally{x.value=!1}},N=()=>{y.value=!1,Object.assign(o,{username:"",api_key:"",quota:-1,expire_at:"",is_admin:!1}),k.value=!0},R=()=>{const n="abcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let u=0;u<8;u++)e+=n.charAt(Math.floor(Math.random()*n.length));o.username="user_"+e},K=n=>{y.value=!0,Object.assign(o,{username:n.username,api_key:n.api_key,quota:n.quota,expire_at:n.expire_at?n.expire_at.slice(0,19):"",is_admin:!!n.is_admin}),k.value=!0},P=()=>{B.value.validate(async n=>{if(!n)return;const e={quota:Number(o.quota),is_admin:!!o.is_admin};o.expire_at&&(e.expire_at=new Date(o.expire_at).toISOString());try{y.value?(await w.put(`/api/users/${encodeURIComponent(o.username)}`,e),f.success("更新用户成功")):(await w.post("/api/users",{username:o.username,...e}),f.success("创建用户成功（API Key 已自动生成）")),k.value=!1,await b()}catch{f.error("保存用户失败")}})},Y=async n=>{C.value=!0,U.value=!0;try{const{data:e}=await w.get(`/api/users/${encodeURIComponent(n.username)}/usage`);r.value=e}catch{r.value=null,f.error("加载使用情况失败")}finally{C.value=!1}},O=n=>{se.confirm(`确定要删除用户 "${n.username}" 吗？此操作不可撤销。`,"删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await w.delete(`/api/users/${encodeURIComponent(n.username)}`),f.success("用户已删除"),await b()}catch{f.error("删除用户失败")}}).catch(()=>{})},S=()=>{m.username="",m.is_admin="",b()},F=n=>{navigator.clipboard.writeText(n).then(()=>{f.success("已复制到剪贴板")}).catch(()=>{f.error("复制失败")})};return le(b),(n,e)=>{const u=i("el-button"),q=i("el-input"),_=i("el-form-item"),M=i("el-option"),H=i("el-select"),E=i("el-form"),g=i("el-table-column"),L=i("el-tag"),h=i("el-table"),G=i("el-alert"),J=i("el-input-number"),Q=i("el-date-picker"),W=i("el-switch"),j=i("el-dialog"),X=i("el-skeleton"),Z=ae("loading");return v(),T("div",ne,[s("div",oe,[e[11]||(e[11]=s("h2",{class:"text-xl font-semibold"},"用户管理",-1)),l(u,{type:"primary",onClick:N},{default:a(()=>e[10]||(e[10]=[d("新增用户")])),_:1})]),s("div",ie,[l(E,{model:m,layout:"inline",class:"filter-form"},{default:a(()=>[l(_,{label:"用户名"},{default:a(()=>[l(q,{modelValue:m.username,"onUpdate:modelValue":e[0]||(e[0]=t=>m.username=t),placeholder:"搜索用户名",clearable:"",onInput:b},null,8,["modelValue"])]),_:1}),l(_,{label:"管理员"},{default:a(()=>[l(H,{modelValue:m.is_admin,"onUpdate:modelValue":e[1]||(e[1]=t=>m.is_admin=t),placeholder:"全部",clearable:"",onChange:b},{default:a(()=>[l(M,{label:"是",value:"true"}),l(M,{label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:a(()=>[l(u,{onClick:S},{default:a(()=>e[12]||(e[12]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),te((v(),V(h,{data:D.value,border:"",style:{width:"100%"}},{default:a(()=>[l(g,{prop:"username",label:"用户名",width:"180"}),l(g,{prop:"api_key",label:"API Key",width:"300"},{default:a(({row:t})=>[s("div",ue,[s("span",re,p(t.api_key),1),l(u,{link:"",type:"primary",size:"small",onClick:I=>F(t.api_key)},{default:a(()=>e[13]||(e[13]=[d(" 复制 ")])),_:2},1032,["onClick"])])]),_:1}),l(g,{prop:"quota",label:"额度",width:"120"},{default:a(({row:t})=>[d(p(t.quota<0?"无限":t.quota),1)]),_:1}),l(g,{prop:"expire_at",label:"过期时间",width:"220"},{default:a(({row:t})=>[d(p(t.expire_at||"不过期"),1)]),_:1}),l(g,{prop:"is_admin",label:"管理员",width:"120"},{default:a(({row:t})=>[l(L,{type:t.is_admin?"danger":"info"},{default:a(()=>[d(p(t.is_admin?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(g,{prop:"total_tokens",label:"总 Token",width:"140"}),l(g,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[l(u,{size:"small",onClick:I=>K(t)},{default:a(()=>e[14]||(e[14]=[d("编辑")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"primary",onClick:I=>Y(t)},{default:a(()=>e[15]||(e[15]=[d("使用情况")])),_:2},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:I=>O(t)},{default:a(()=>e[16]||(e[16]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,x.value]]),l(j,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=t=>k.value=t),title:y.value?"编辑用户":"新增用户",width:"560px"},{footer:a(()=>[s("span",me,[l(u,{onClick:e[7]||(e[7]=t=>k.value=!1)},{default:a(()=>e[19]||(e[19]=[d("取消")])),_:1}),l(u,{type:"primary",onClick:P},{default:a(()=>e[20]||(e[20]=[d("确定")])),_:1})])]),default:a(()=>[l(E,{ref_key:"formRef",ref:B,model:o,rules:A,"label-width":"100px"},{default:a(()=>[l(_,{label:"用户名",prop:"username"},{default:a(()=>[l(q,{modelValue:o.username,"onUpdate:modelValue":e[2]||(e[2]=t=>o.username=t),disabled:!0},null,8,["modelValue"]),y.value?$("",!0):(v(),T("span",de,"系统自动生成"))]),_:1}),y.value?$("",!0):(v(),V(_,{key:0},{default:a(()=>[l(u,{onClick:R},{default:a(()=>e[17]||(e[17]=[d("生成用户名")])),_:1})]),_:1})),y.value?(v(),V(_,{key:1,label:"API Key",prop:"api_key"},{default:a(()=>[l(q,{modelValue:o.api_key,"onUpdate:modelValue":e[3]||(e[3]=t=>o.api_key=t),"show-password":"",disabled:""},null,8,["modelValue"])]),_:1})):(v(),V(G,{key:2,title:"创建用户时用户名和 API Key 由系统自动生成",type:"info",closable:!1,"show-icon":"",class:"mb-3"})),l(_,{label:"额度"},{default:a(()=>[l(J,{modelValue:o.quota,"onUpdate:modelValue":e[4]||(e[4]=t=>o.quota=t),min:-1,step:1e3},null,8,["modelValue"]),e[18]||(e[18]=s("span",{class:"form-hint-inline"},"-1 表示无限",-1))]),_:1}),l(_,{label:"过期时间"},{default:a(()=>[l(Q,{modelValue:o.expire_at,"onUpdate:modelValue":e[5]||(e[5]=t=>o.expire_at=t),type:"datetime","value-format":"YYYY-MM-DDTHH:mm:ss",placeholder:"可选，不填表示不过期",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"管理员"},{default:a(()=>[l(W,{modelValue:o.is_admin,"onUpdate:modelValue":e[6]||(e[6]=t=>o.is_admin=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:U.value,"onUpdate:modelValue":e[9]||(e[9]=t=>U.value=t),title:"用户使用情况",width:"520px"},{default:a(()=>[C.value?(v(),V(X,{key:0,rows:6,animated:""})):r.value?(v(),T("div",pe,[s("div",_e,[e[21]||(e[21]=s("span",null,"用户名",-1)),s("strong",null,p(r.value.username),1)]),s("div",fe,[e[22]||(e[22]=s("span",null,"输入 Token",-1)),s("strong",null,p(r.value.input_tokens),1)]),s("div",ce,[e[23]||(e[23]=s("span",null,"输出 Token",-1)),s("strong",null,p(r.value.output_tokens),1)]),s("div",ve,[e[24]||(e[24]=s("span",null,"总 Token",-1)),s("strong",null,p(r.value.total_tokens),1)]),s("div",ye,[e[25]||(e[25]=s("span",null,"额度",-1)),s("strong",null,p(r.value.unlimited?"无限":r.value.quota),1)]),s("div",ge,[e[26]||(e[26]=s("span",null,"剩余额度",-1)),s("strong",null,p(r.value.unlimited?"无限":r.value.remaining),1)]),s("div",ke,[e[27]||(e[27]=s("span",null,"过期时间",-1)),s("strong",null,p(r.value.expire_at||"不过期"),1)])])):$("",!0)]),_:1},8,["modelValue"])])}}},xe=ee(be,[["__scopeId","data-v-1a9578f1"]]);export{xe as default};
